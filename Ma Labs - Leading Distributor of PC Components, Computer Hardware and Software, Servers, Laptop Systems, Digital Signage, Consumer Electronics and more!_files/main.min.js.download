/* Cookies */
function getCookie(cname) {
	var name = cname + "=";
	var ca = document.cookie.split(';');
	for(var i = 0; i <ca.length; i++) {
		var c = ca[i];
		while (c.charAt(0)==' ') {
			c = c.substring(1);
		}
		if (c.indexOf(name) == 0) {
			return c.substring(name.length,c.length);
		}
	}
	return "";
}
function acceptCookies() {
	var d = new Date();
	var exdays = 3650;
	d.setTime(d.getTime() + (exdays*24*60*60*1000));
	var expires = "expires="+ d.toUTCString();
	document.cookie = "malabscookienotice=1" + ";" + expires + ";";;
	$('#accept_cookie').val('true');
	$('#cookie_notice').submit();
	
	location.reload();
}

if (getCookie('malabscookienotice') == 0) {
	document.cookie = "malabscookienotice=0";
	$('#cookies').css('display', 'table');	
}



// Initializing functions
$(document).ready(function() {
	adjustProducts();
	adjustSections();
	autoSlide();
});



// Hamburger menu toggle
var toggle;
$('.navbar-toggle').click(function() {
	if (!toggle) {
		$('#navmenu').css('display', 'block');
		$('#navmenu a[class="navcategory"]').css('display', 'block');
		$('#navicons').css('display', 'block');
		$('#navsearch').css('display', 'block');
		$('#navlogin').css('display', 'table');
		toggle = true;
	}
	else {
		hideSubnav();
		// hideSearch();
		$('#navmenu').css('display', 'none');
		$('#navmenu a[class="navcategory"]').css('display', 'none');
		$('#navaccountlinks').css('display', 'none');
		if (window.innerWidth < 1035) {
			$('#navicons').css('display', 'none');
			$('#navsearch').css('display', 'none');
			$('#navlogin').css('display', 'none');
		}
		toggle = false;
	}
});

// Keeps navbar from disappearing
function hamburgerMenu() {
	if (window.innerWidth < 1035 && !toggle) $('#navmenu a[class="navcategory"]').css('display', 'none');
	else $('#navmenu a[class="navcategory"]').css('display', 'block');
}


// Toggle arrow icons on navbar
function resetNav() {
	subnavCategory.removeClass('active');
	subnavCategory.addClass('navcategory');
	$('a[category="products"] i').attr('class', 'fa fa-caret-down');
	$('a[category="solutions"] i').attr('class', 'fa fa-caret-down');
	$('a[category="partners"] i').attr('class', 'fa fa-caret-down');
	$('a[category="company"] i').attr('class', 'fa fa-caret-down');
	$('a[category="support"] i').attr('class', 'fa fa-caret-down');
	if (window.innerWidth > 1034 && window.innerWidth < 1350) $('.navcategory i').css('line-height', '70px');
	else $('.navcategory i').css('line-height', '90px');
	toggle = false;
}
function updateNav(el) {
	el.attr('class', 'active');
	el.attr('class', 'navcategory');
	el.find('i').attr('class', 'fa fa-caret-up');
	if (window.innerWidth > 1034 && window.innerWidth < 1350) el.find('i').css('line-height', '70px');
	else el.find('i').css('line-height', '90px');
}

// Navbar animation
function showSubnav(category) {
	$('.subnav').css({'height': 'auto', 'display': 'none'});
	$('#nav' + category).slideDown(200);
	// $('#nav + category').css({'display': 'block'});
	toggle = true;
}
function hideSubnav() {
	resetNav();
	$('.subnav').css('height', 'auto');
	$('.subnav').slideUp(150);
}

// Navbar dropdown functions
var subnavCategory = $('.navcategory');
subnavCategory.click(function() {
	resetNav();
	var category = $(this).attr('category');
	if ($('#nav' + category).is(':visible')) hideSubnav();
	else {
		showSubnav(category);
		updateNav($(this));
	}
})


$('.subnav a').on('mouseover', function() {
	var img = $(this).find('img');
	var src = img.attr('src').replace('.png', '_blue.png');
	img.attr('src', src);
});
$('.subnav a').on('mouseout', function() {
	var img = $(this).find('img');
	var src = img.attr('src').replace('_blue.png', '.png');
	img.attr('src', src);
});


// Attachs each dropdown under its category on mobile and tablet
function mobileSubnav() {
	if (window.innerWidth < 1035 && !toggle) {
		$('#navmenu').css('display', 'none');
		$('#navicons').css('display', 'none');
		$('#navsearch').css('display', 'none');
		$('#navlogin').css('display', 'none');
	}
	else {
		$('#navmenu').css('display', 'block');
		$('#navicons').css('display', 'block');
		$('#navsearch').css('display', 'block');
		$('#navlogin').css('display', 'block');
	}
	if (window.innerWidth < 1035) {
		for (var i = 0; i < subnavCategory.length; i++){
			var category = subnavCategory.eq(i);

			// Look for active categories
			if (category.hasClass('active')) {
				category.removeClass('active');
				var active = category.attr('category');
			}

			// Attach dropdowns to categories
			category = category.attr('category');
			$('#nav' + category).detach().insertAfter('a[category="' + category + '"').addClass('mobile');

			// Reactivate category
			if (active) {
				subnavCategory.eq(i).addClass('active');
				active = false;
			}
		}
	}

	// Attach dropdown under the menu on desktop
	// else if ($('#subnav > .subnav').length === 0)
	else
		$('.subnav').detach().appendTo('#subnav').removeClass('mobile');
}

$(document).ready(function() {
	mobileSubnav();
});
$(window).resize(function() {    
	mobileSubnav();
});


// Responsive design for navbar dropdowns
$(window).resize(function() {
	adjustPadding();
	adjustProducts();
	hamburgerMenu();
});
function adjustPadding() {
	if (!$('.subnav').is(':animated')) {
		if (window.innerWidth >= 1635 && $('.subnav').css('padding') != '40px 130px 50px') {
			$('.subnav').stop().css({'padding': '40px 130px 50px'}, {queue: false, duration: 300});
		}
		if (window.innerWidth < 1635 && window.innerWidth >= 1200 && $('.subnav').css('padding') != '400px 80px 50px') {
			$('.subnav').stop().css({'padding': '40px 80px 50px'}, {queue: false, duration: 300});
		}
		if (window.innerWidth < 1475 && $('.subnav').css('padding') != '30px') {
			$('.subnav').stop().css({'padding': '40px 30px 50px'}, {queue: false, duration: 300});
		}
	}
}
function adjustProducts() {
	if (window.innerWidth < 1722 && window.innerWidth > 1329) {
		$('.hardware-software').detach().appendTo($('.column').eq(0));
		$('.pc-laptops').detach().appendTo($('.column').eq(1));
		$('.electronics').detach().appendTo($('.column').eq(1));
		$('.accessories').detach().insertAfter($('.column').eq(1));
	}
	else if (window.innerWidth < 1330) {
		$('.hardware-software').detach().appendTo($('.column').eq(0));
		$('.pc-laptops').detach().appendTo($('.column').eq(0));
		$('.electronics').detach().appendTo($('.column').eq(1));
		$('.accessories').detach().appendTo($('.column').eq(1));
	}
	else {
		$('.hardware-software').detach().insertAfter($('.column').eq(1));
		$('.pc-laptops').detach().insertAfter($('.hardware-software'));
		$('.electronics').detach().insertAfter($('.pc-laptops'));
		$('.accessories').detach().insertAfter($('.electronics'));
	}
}



// Navaccount Links
$('#navaccount > a').click(function() {
	// hideSearch();
	if ($('#navaccountlinks').is(':hidden')) {
		$('#navaccountlinks').css('display', 'block');
		toggle = true;
	}
	else $('#navaccountlinks').css('display', 'none');
	return false;
});



// Search bar animations
// function showSearch() {
// 	$('#navaccountlinks').css('display', 'none');
// 	$('#search_subnav').css('display', 'block');
// 	$('#search_subnav input').focus();
// 	toggle = true;
// }
// function hideSearch() {
// 	$('#search_subnav').hide();
// }

// Search bar functions
// $('#navsearch i').click(function() {
// 	if ($('#search_subnav').is(':hidden')) showSearch();
// 	else hideSearch();
// });
// 'X' search bar
// $('#search_subnav i').click(function() {
// 	hideSearch();
// });

// $('#top_select').on('change', function() {
	// $('#top_keyword').attr('disabled', true);
	// $(this).parent().submit();
// });

// Exits search menu 
$('body').click(function(e) {
	if (
		$('.subnav').is(':visible') &&
		$(e.target).closest('#navlink').length === 0 &&
		$(e.target).closest('.subnav').length === 0 &&
		// $(e.target).closest('#navsearch').length === 0 &&
		// $(e.target).closest('#search_subnav').length === 0 &&
		$(e.target).closest('#navaccountlinks').length === 0
	)
		hideSubnav();

	// if (
	// 	$('#search_subnav').is(':visible') &&
	// 	!$('.subnav').is(':visible') &&
	// 	$(e.target).closest('#navlink').length === 0 &&
	// 	$(e.target).closest('.subnav').length === 0 &&
	// 	$(e.target).closest('#navsearch').length === 0 &&
	// 	$(e.target).closest('#search_subnav').length === 0
	// )
	// 	hideSearch();

	if (
		// $('#search_subnav').is(':visible') &&
		$('.subnav').is(':visible') &&
		$(e.target).closest('#navlink').length === 0 &&
		$(e.target).closest('.subnav').length === 0
		// $(e.target).closest('#navsearch').length === 0 &&
		// $(e.target).closest('#search_subnav').length === 0
	)
		hideSubnav();

	if (
		$('#navaccountlinks').is(':visible') &&
		!$('.subnav').is(':visible') &&
		$(e.target).closest('#navaccountlinks').length === 0 &&
		$(e.target).closest('#navlink').length === 0 &&
		$(e.target).closest('.subnav').length === 0
	)
		$('#navaccountlinks').css('display', 'none');

	if (
		$('#navaccountlinks').is(':visible') &&
		$('.subnav').is(':visible') &&
		$(e.target).closest('#navaccountlinks').length === 0 &&
		$(e.target).closest('#navlink').length === 0 &&
		$(e.target).closest('.subnav').length === 0
		// $(e.target).closest('#navsearch').length === 0
	)
		hideSubnav();
});



/*
/ Hero slider
*/
var slideDelay = 10000;
var fadeDelay = 400;

var slideCounter = 0;
var lastIndex = $('#banner a').length - 1;

var loopSlider;

function autoSlide() {
	loopSlider = setTimeout(function() {
		// Loop slider at end
		if (slideCounter == lastIndex) {
			slideCounter = -1;
			$('#banner a').css({'z-index': '0','opacity': '0'});
			$('#banner a:eq(0)').css({'z-index': '1','opacity': '0'});
			$('#banner a:eq(' + lastIndex + ')').css({'z-index': '0','opacity': '1'});
			setTimeout(function() {
				$('#banner a:eq(' + lastIndex + ')').css('opacity', '0');
			}, slideDelay)
		}


		// Animate slider
		slideCounter++;
		changeSlide(slideCounter);
	}, slideDelay);

	setTimeout("autoSlide()", slideDelay);
}


function changeSlide(index) {
	$('#banner a').stop();
	$('#banner a:eq(' + index + ')').css({'z-index': '1','opacity': '0'});
	$('#banner a:eq(' + index + ')').animate({'opacity': '1'}, fadeDelay, 'linear');

	// Highlight navigation
	$('#slider_nav li').attr('class', 'slider-btn');
	$('#slider_nav li:eq(' + index + ')').addClass('active');
}


// Create slider navigation
$(document).ready(function() {
	// $('#slider_nav').css('left', 'calc(50% - ' + $('#banner a').length*31 +'px)');
	for (var i = 0; i < $('#banner a').length; i++) {
		var li = document.createElement('li');
		li.setAttribute('class', 'slider-btn');
		if (i == 0) li.classList.add('active');
		$('#slider_nav').append(li);
	}


	// Slider button navigation
	$('.slider-btn').click(function() {
		clearTimeout(loopSlider);
		slideCounter = $(this).index();

		// Animate Slider
		$('#banner a').css('z-index', '0');
		changeSlide($(this).index());
	});
});


// Slider arrow navigation
$('#banner .fa-angle-left').click(function() {
	clearTimeout(loopSlider);
	if (slideCounter == 0)
		slideCounter = lastIndex + 1;
	slideCounter--;

	// Animate Slider
	$('#banner a').css({'z-index': '0', 'opacity': '0'});
	if (slideCounter == lastIndex) $('#banner a:eq(0)').css('opacity', '1');
	else $('#banner a:eq(' + (slideCounter + 1) + ')').css('opacity', '1');
	changeSlide(slideCounter);
});
$('#banner .fa-angle-right').click(function() {
	clearTimeout(loopSlider);
	if (slideCounter == lastIndex)
		slideCounter = -1;
	slideCounter++;

	// Animate Slider
	$('#banner a').css({'z-index': '0', 'opacity': '0'});
	$('#banner a:eq(' + (slideCounter - 1) + ')').css('opacity', '1');
	changeSlide(slideCounter);
});



// Responsive section columns
$(window).resize(function() {
	adjustSections();
});
function adjustSections() {
	if (window.innerWidth > 1474) {
		$('div[data-section=section-one]').removeClass('section-one');
		$('div[data-section=section-two]').removeClass('section-two');
		$('div[data-section=section-three]').addClass('section-three');
		$('div[data-section=section-four]').addClass('section-four');
	}
	else if (window.innerWidth > 1034) {
		$('div[data-section=section-one]').removeClass('section-one');
		$('div[data-section=section-two]').addClass('section-two');
		$('div[data-section=section-three]').removeClass('section-three');
		$('div[data-section=section-four]').removeClass('section-four');
	}
	else {
		$('div[data-section=section-one]').addClass('section-one');
		$('div[data-section=section-two]').removeClass('section-two');
		$('div[data-section=section-three]').removeClass('section-three');
		$('div[data-section=section-four]').removeClass('section-four');
	}
}



// Sidebar
var sidebarToggle;
function minimizeSidebar() {
	if (window.innerWidth < 768) {
		$('.sidebar').css('height', '42px');
		sidebarToggle = false;
	}
	else {
		$('.sidebar').css('height', '100%');
		sidebarToggle = true;
	}
}
$('.sidebar-arrow').click(function() {
	if (!sidebarToggle) {
		$('.sidebar').animate({'height': '100%'}, 200);
		sidebarToggle = true;
	}
	else {
		hideSubnav();
		$('.sidebar').animate({'height': '42px'}, 200);
		sidebarToggle = false;
	}
});
$(document).ready(function() {
	minimizeSidebar();
});
$(window).resize(function() {    
	minimizeSidebar();
});



$('#featured_stores a').on('mouseover', function() {
	var src = $(this).find('img').attr('src');
	src = src.replace('_withoutline.jpg', '.png');
	$(this).find('img').attr('src', src);
});
$('#featured_stores a').on('mouseout', function() {
	var src = $(this).find('img').attr('src');
	src = src.replace('.png', '_withoutline.jpg');
	$(this).find('img').attr('src', src);
});
